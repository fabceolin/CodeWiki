# Risk Profile: Affected Modules Detection for Incremental Documentation Updates

**Date:** 2026-01-26
**Reviewer:** Quinn (Test Architect)
**Story:** docs/stories/incremental-doc-update-affected-modules.md
**Mode:** YOLO (Rapid Assessment)

## Executive Summary

- **Total Risks Identified:** 6
- **Critical Risks:** 0
- **High Risks:** 1
- **Medium Risks:** 3
- **Low Risks:** 2
- **Risk Score:** 73/100

## Critical Risks Requiring Immediate Attention

*None identified - no critical (score 9) risks.*

## High Risks

### TECH-001: N-Hop Depth Miscalculation

**Score: 6 (High)**
**Probability:** Medium - Algorithm is straightforward but edge cases exist
**Impact:** High - Under-inclusion misses regeneration needs; over-inclusion wastes resources

The N-hop dependent detection algorithm could incorrectly traverse the reverse dependency graph, leading to either missing affected modules or including too many. Circular dependencies or deeply nested graphs may behave unexpectedly.

**Affected Components:**
- `graph_diff.py:get_affected_components()`
- `graph_diff.py:build_reverse_dependency_map()`

**Mitigation:**
- Unit tests with circular dependency graphs
- Test with depth=0, 1, 2, 3 to verify boundary behavior
- Add verbose logging to trace traversal path
- Consider adding a `--max-components` safeguard

**Testing Focus:**
- BFS traversal doesn't revisit nodes
- Circular dependency handling
- Depth boundary edge cases

## Risk Distribution

### By Category
- Technical: 3 risks (1 high, 1 medium, 1 low)
- Data: 2 risks (2 medium)
- Operational: 1 risk (1 low)
- Security: 0 risks
- Business: 0 risks

### By Component
- Backend (`graph_diff.py`): 4 risks
- CLI (`affected.py`): 2 risks
- Database: 0 risks
- Infrastructure: 0 risks

## Detailed Risk Register

| Risk ID | Category | Description | Probability | Impact | Score | Priority |
|---------|----------|-------------|-------------|--------|-------|----------|
| TECH-001 | Technical | N-hop depth miscalculation leads to over/under-inclusion | Medium (2) | High (3) | 6 | High |
| DATA-001 | Data | Hash comparison false positives from whitespace changes | Medium (2) | Medium (2) | 4 | Medium |
| TECH-002 | Technical | Module tree/graph component ID mismatch | Medium (2) | Medium (2) | 4 | Medium |
| DATA-002 | Data | Malformed JSON files cause cryptic errors | Medium (2) | Medium (2) | 4 | Medium |
| OPS-001 | Operational | Memory pressure on large graphs | Low (1) | High (3) | 3 | Low |
| TECH-003 | Technical | CLI argument mutual exclusion edge cases | Medium (2) | Low (1) | 2 | Low |

## Risk-Based Testing Strategy

### Priority 1: High Risk Tests (TECH-001)
- Test N-hop traversal with circular dependencies
- Test depth=0 (only direct changes)
- Test depth=5 on deep dependency chain
- Verify BFS traversal doesn't revisit nodes
- Test with disconnected graph components

### Priority 2: Medium Risk Tests (DATA-001, DATA-002, TECH-002)
- Test with whitespace-only changes
- Test with empty JSON files
- Test with missing keys in graph
- Test component ID variations (dots, underscores, slashes)
- Test when no modules match affected components

### Priority 3: Standard Tests
- CLI argument validation
- Output format verification (JSON to stdout, summary to stderr)
- Exit codes (0 success, 1 error)

## Risk Acceptance Criteria

### Must Fix Before Production
- TECH-001: Add comprehensive unit tests for N-hop traversal edge cases
- DATA-002: Implement JSON validation with clear error messages

### Can Deploy with Mitigation
- DATA-001: Document known limitation (over-regeneration on whitespace changes)
- TECH-002: Add warning when component mapping fails

### Accepted Risks
- OPS-001: Memory usage on very large graphs (acceptable for MVP)
- TECH-003: CLI argument edge cases (low impact)

## Monitoring Requirements

Post-deployment monitoring for:
- **Performance:** Track execution time and memory usage for varying graph sizes
- **Operational:** Log unmapped component counts in verbose mode
- **Data:** Monitor false positive rate through user feedback

## Gate YAML Block

```yaml
risk_summary:
  totals:
    critical: 0
    high: 1
    medium: 3
    low: 2
  highest:
    id: TECH-001
    score: 6
    title: "N-hop depth miscalculation leads to over/under-inclusion"
  recommendations:
    must_fix:
      - "Add unit tests for circular dependency handling"
      - "Implement verbose traversal logging for debugging"
    monitor:
      - "Track unmapped component percentage in verbose mode"
      - "Profile memory usage on large repositories"
```

## Risk Score Calculation

```
Base Score = 100
- High (6): -10 points × 1 = -10
- Medium (4): -5 points × 3 = -15
- Low (2-3): -2 points × 2 = -4
Final Score = 100 - 10 - 15 - 2 = 73/100
```

---

*Generated by Quinn (Test Architect) - BMAD Framework*
