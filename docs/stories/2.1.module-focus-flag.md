# Story 2.1: Module Focus Flag

## Status

Draft

## Story

**As a** CodeWiki user,
**I want** a `--module-focus` flag to regenerate specific modules by name,
**so that** I can recover from partial runs without reprocessing the entire codebase.

## Context

When running CodeWiki on large codebases (e.g., 100K+ LOC), the generation process may fail partway through due to:
- API timeouts on large modules
- Rate limiting
- Network issues
- Process interruptions

Currently, the only option is to re-run the entire process, which:
1. Wastes time reprocessing already-documented modules
2. Overwrites existing documentation unnecessarily
3. May hit the same failure again without ability to skip problematic modules

## Acceptance Criteria

1. New CLI flag `--module-focus` accepts comma-separated module names (e.g., `--module-focus "quote_shop,authentication,alerts"`)
2. When `--module-focus` is provided:
   - Skip dependency analysis phase (reuse existing `module_tree.json`)
   - Skip clustering phase (reuse existing tree)
   - Only generate documentation for specified modules and their sub-modules
3. Modules are matched by name from `module_tree.json` keys
4. If a specified module doesn't exist in tree, warn and skip it
5. Flag can be combined with other options like `--doc-type`, `--instructions`
6. Add `--skip-existing` flag to skip modules that already have .md files
7. Support `--resume` flag that auto-detects modules without .md files and regenerates only those

## Tasks / Subtasks

- [ ] Task 1: Add CLI flags (AC: 1, 6, 7)
  - [ ] Add `--module-focus` option to `generate.py` command
  - [ ] Add `--skip-existing` boolean flag
  - [ ] Add `--resume` boolean flag
  - [ ] Validate that module names are non-empty strings
  - [ ] Update help text with examples

- [ ] Task 2: Implement module tree loading (AC: 2, 3)
  - [ ] Create `load_existing_module_tree()` function in `documentation_generator.py`
  - [ ] Load `module_tree.json` from output directory if exists
  - [ ] Parse and validate tree structure
  - [ ] Handle missing file with clear error message

- [ ] Task 3: Implement module filtering (AC: 2, 3, 4)
  - [ ] Create `filter_modules_by_names()` function
  - [ ] Match module names against tree keys (exact match)
  - [ ] Include all sub-modules of matched modules
  - [ ] Log warning for unmatched module names
  - [ ] Return filtered tree structure

- [ ] Task 4: Implement resume detection (AC: 6, 7)
  - [ ] Create `detect_missing_modules()` function
  - [ ] Scan output directory for existing .md files
  - [ ] Compare with module tree to find undocumented modules
  - [ ] Support both top-level and sub-module detection

- [ ] Task 5: Integrate with documentation generator (AC: 2, 5)
  - [ ] Modify `DocumentationGenerator` to accept focus modules
  - [ ] Skip phases 1-2 when tree is provided
  - [ ] Filter processing to only focused modules
  - [ ] Preserve existing files when not in focus list

- [ ] Task 6: Update doc_generator adapter (AC: 1-7)
  - [ ] Pass module_focus, skip_existing, resume flags through Config
  - [ ] Add to `agent_instructions` dict
  - [ ] Update both regular and Claude Code paths

## Technical Notes

- Module names are the keys in `module_tree.json` (e.g., "sea_tracking", "quotes_air")
- Sub-modules are nested under their parent's `sub_modules` key
- Existing implementation uses `_process_module()` which can be filtered

## Example Usage

```bash
# Regenerate specific modules
codewiki generate --use-claude-code --module-focus "quote_shop,authentication"

# Resume from previous run (auto-detect missing)
codewiki generate --use-claude-code --resume

# Skip modules that already have docs
codewiki generate --use-claude-code --skip-existing

# Combine flags
codewiki generate --use-claude-code --module-focus "business_intelligence" --doc-type architecture
```

## Definition of Done

- [ ] All acceptance criteria met
- [ ] Unit tests for new functions
- [ ] Integration test with sample module tree
- [ ] CLI help updated
- [ ] CHANGELOG updated
